<html><head><meta charset="utf-8">
<script src="promjs.js"></script>
<script>

async function fetchAsync (url) {
  let response = await fetch(url);
  let data = await response.json();
  return data;
}

function demo() {
  let p = promCache.New()

  let prometheus = "http://192.168.99.100:30090"
  let metric = "scrape_duration_seconds"
  let hours = 1

  fetchAsync(`${prometheus}/api/v1/query?query=${metric}[${hours}h]`).then(function(d){
    p.SetMetrics(d.data.result)
    p.SetModel(`${metric}{monitor_type=""} >= bool 0.1`, {
      "__name__":  "model",
      "name":      metric,
      "threshold": "0.1",
    })
    p.SetHealth(`(avg_over_time(model{name="${metric}",monitor_type=""}[10m]) >=bool 0.3) * 2`, {
      "__name__": "health",
      "severity": "warning",
      "window":   "10m",
    })
    let millis = performance.now()
    let res = p.InstantQuery("{__name__=~\".+\"}")
    millis = performance.now() - millis

    console.log("millis", millis)
    console.log("result", res)
  })

  return p
}
</script>
</head>
<body>
</body>
</html>
